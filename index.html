<!DOCTYPE html>
<html lang="bn">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>‡¶Ü‡¶Æ‡¶æ‡¶∞ Doraemon-‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Hind+Siliguri:wght@400;500;600;700&display=swap" rel="stylesheet">
    <style>
        body {
            font-family: 'Hind Siliguri', sans-serif;
        }
        .gradient-bg {
            background: linear-gradient(135deg, #FFE5E5 0%, #FFC7C7 100%);
        }
        .card {
            background-color: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .pin-container {
            display: flex;
            justify-content: center;
            align-items: center;
            height: 100vh;
        }
    </style>
</head>
<body class="gradient-bg text-gray-800">

    <!-- PIN Screen -->
    <div id="pin-screen" class="pin-container">
        <div class="card p-8 rounded-2xl shadow-xl text-center max-w-sm mx-auto">
            <h2 class="text-2xl font-bold mb-4 text-gray-700">Hi Doraemon <br>‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶¨‡¶æ‡¶®‡¶æ‡¶®‡ßã...</h2>
            <p class="text-gray-600 mb-6">‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶ø‡¶® ‡¶®‡¶Æ‡ßç‡¶¨‡¶∞‡¶ü‡¶ø ‡¶¶‡¶ø‡ßü‡ßá ‡¶™‡ßç‡¶∞‡¶¨‡ßá‡¶∂ ‡¶ï‡¶∞‡ßã</p>
            <input type="password" id="pin-input" class="w-full p-3 border border-gray-300 rounded-lg text-center text-lg tracking-widest focus:ring-2 focus:ring-rose-400 focus:border-transparent" placeholder="‚Ä¢‚Ä¢‚Ä¢‚Ä¢">
            <button id="enter-btn" class="mt-6 w-full bg-rose-500 hover:bg-rose-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-md">‡¶≠‡ßá‡¶§‡¶∞‡ßá ‡¶è‡¶∏‡ßã</button>
            <p id="pin-error" class="text-red-500 mt-4 text-sm h-4"></p>
        </div>
    </div>

    <!-- Main Content (Hidden by default) -->
    <div id="main-content" class="hidden">
        <div class="container mx-auto p-4 md:p-8 max-w-4xl">
            <header class="text-center mb-8">
                <h1 id="main-header" class="text-3xl md:text-4xl font-bold text-rose-600"></h1>
                <p class="text-lg md:text-xl text-gray-700 mt-2">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ì‡¶á ‡¶Æ‡¶ø‡¶∑‡ßç‡¶ü‡¶ø ‡¶†‡ßã‡¶Å‡¶ü ‡¶¶‡ßÅ‡¶ü‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø</p>
            </header>

            <main class="space-y-8">
                <!-- Challenge Tracker -->
                <section id="challenge-section" class="card p-6 rounded-2xl shadow-lg text-center">
                    <!-- Loading state -->
                    <div id="loading-state"><p>‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßã, ‡¶¨‡¶â...</p></div>
                    <!-- Start state -->
                    <div id="start-state" class="hidden">
                        <h2 class="text-2xl font-semibold mb-4">‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú‡¶ü‡¶æ ‡¶®‡ßá‡¶¨‡ßá, Ananna?</h2>
                        <p class="mb-4">‡¶Ü‡¶Æ‡¶ø ‡¶ú‡¶æ‡¶®‡¶ø ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶™‡¶æ‡¶∞‡¶¨‡ßá‡•§ ‡¶ö‡¶≤‡ßã, ‡¶Ü‡¶ú ‡¶•‡ßá‡¶ï‡ßá ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡¶ø?</p>
                        <button id="start-challenge-btn" class="bg-teal-500 hover:bg-teal-600 text-white font-bold py-3 px-6 rounded-lg transition duration-300 shadow-md">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶Ü‡¶Æ‡¶ø ‡¶™‡¶æ‡¶∞‡¶¨‡ßã!</button>
                    </div>
                    <!-- Active state -->
                    <div id="active-challenge-state" class="hidden">
                        <h2 id="challenge-day-text" class="text-2xl md:text-3xl font-bold text-teal-600 mb-4">‡¶¶‡¶ø‡¶®: ‡ßß/‡ß©‡ß¶</h2>
                        <div class="w-full bg-gray-200 rounded-full h-4 mb-6"><div id="progress-bar" class="bg-teal-500 h-4 rounded-full" style="width: 0%"></div></div>
                        
                        <div id="log-form">
                            <label for="bite-count" class="block text-lg font-medium mb-2">‡¶Ü‡¶ú ‡¶ï‡¶§‡¶¨‡¶æ‡¶∞ ‡¶ï‡¶∑‡ßç‡¶ü ‡¶¶‡¶ø‡ßü‡ßá‡¶õ‡ßã ‡¶†‡ßã‡¶Å‡¶ü ‡¶¶‡ßÅ‡¶ü‡ßã‡¶ï‡ßá?</label>
                            <input type="number" id="bite-count" min="0" class="w-full max-w-xs mx-auto p-3 border border-gray-300 rounded-lg text-center text-lg focus:ring-2 focus:ring-teal-500 focus:border-transparent" placeholder="‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶≤‡¶ø‡¶ñ‡ßÅ‡¶®">
                            <button id="log-today-btn" class="mt-4 bg-blue-500 hover:bg-blue-600 text-white font-bold py-3 px-8 rounded-lg transition duration-300 shadow-md">‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶æ‡¶ì</button>
                            <p id="log-feedback" class="mt-2 text-sm text-green-600 h-4"></p>
                        </div>

                        <div id="observer-status" class="hidden">
                            <p id="partner-status-text" class="text-lg text-gray-700"></p>
                        </div>
                    </div>
                </section>

                <!-- Log History -->
                <section id="history-section" class="card p-6 rounded-2xl shadow-lg hidden">
                    <h3 class="text-xl font-bold mb-4 text-center">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ‡¶∞ ‡¶∏‡¶æ‡¶ï‡ßç‡¶∑‡ßÄ</h3>
                    <div id="log-history" class="space-y-3 max-h-60 overflow-y-auto pr-2"></div>
                </section>
                
                <!-- New Lip Care Section -->
                <section class="card p-6 rounded-2xl shadow-lg">
                    <h3 class="text-2xl font-bold mb-4 text-center text-rose-500">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶†‡ßã‡¶Å‡¶ü‡ßá‡¶∞ ‡¶Ø‡¶§‡ßç‡¶® ‡¶®‡¶æ‡¶ì, Doraemon</h3>
                    <p class="text-center text-gray-700 leading-relaxed">‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶π‡¶æ‡¶∏‡¶ø‡¶ü‡¶æ ‡¶Ø‡ßá‡¶Æ‡¶® ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞, ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶†‡ßã‡¶Å‡¶ü ‡¶¶‡ßÅ‡¶ü‡ßã‡¶ì ‡¶†‡¶ø‡¶ï ‡¶§‡ßá‡¶Æ‡¶®‡¶á ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞‡•§ ‡¶è‡¶á ‡¶†‡ßã‡¶Å‡¶ü ‡¶¶‡ßÅ‡¶ü‡ßã ‡¶∂‡ßÅ‡¶ß‡ßÅ‡¶á ‡¶ï‡¶æ‡¶Æ‡ßú‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶®‡ßü‡•§ ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ø‡¶§‡ßç‡¶® ‡¶®‡¶ø‡¶≤‡ßá‡¶á ‡¶¶‡ßá‡¶ñ‡¶¨‡ßá, ‡¶ì‡¶ó‡ßÅ‡¶≤‡ßã ‡¶Ü‡¶∞‡¶ì ‡¶ï‡¶§ ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶Ü‡¶∞ ‡¶®‡¶∞‡¶Æ ‡¶π‡ßü‡ßá ‡¶â‡¶†‡¶¨‡ßá‡•§ ‡¶∏‡¶¨‡¶∏‡¶Æ‡ßü ‡¶≤‡¶ø‡¶™ ‡¶¨‡¶æ‡¶Æ ‡¶¨‡ßç‡¶Ø‡¶¨‡¶π‡¶æ‡¶∞ ‡¶ï‡¶∞‡¶¨‡ßá, ‡¶Ü‡¶∞ ‡¶™‡ßç‡¶∞‡¶ö‡ßÅ‡¶∞ ‡¶™‡¶æ‡¶®‡¶ø ‡¶ñ‡¶æ‡¶¨‡ßá, ‡¶ï‡ßá‡¶Æ‡¶®?</p>
                </section>

                <!-- Health Risks Section -->
                <section class="card p-6 rounded-2xl shadow-lg">
                     <h3 class="text-xl font-bold mb-4 text-gray-900 text-center">‡¶ï‡ßá‡¶® ‡¶†‡ßã‡¶Å‡¶ü‡¶ï‡ßá ‡¶ï‡¶∑‡ßç‡¶ü ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶â‡¶ö‡¶ø‡¶§ ‡¶®‡ßü</h3>
                    <div class="grid md:grid-cols-2 gap-6 text-left">
                        <div>
                            <h4 class="font-semibold text-lg mb-2 text-rose-700">‡¶§‡¶æ‡ßé‡¶ï‡ßç‡¶∑‡¶£‡¶ø‡¶ï ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ:</h4>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>‡¶¨‡ßç‡¶Ø‡¶•‡¶æ ‡¶π‡¶ì‡ßü‡¶æ, ‡¶´‡ßÅ‡¶≤‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ ‡¶¨‡¶æ ‡¶∞‡¶ï‡ßç‡¶§ ‡¶¨‡ßá‡¶∞ ‡¶π‡¶ì‡ßü‡¶æ‡•§</li>
                                <li>‡¶†‡ßã‡¶Å‡¶ü‡ßá‡¶∞ ‡¶ö‡¶æ‡¶Æ‡ßú‡¶æ ‡¶â‡¶†‡ßá ‡¶∞‡ßÅ‡¶ï‡ßç‡¶∑ ‡¶π‡ßü‡ßá ‡¶Ø‡¶æ‡¶ì‡ßü‡¶æ‡•§</li>
                                <li>‡¶ï‡ßç‡¶∑‡¶§‡¶∏‡ßç‡¶•‡¶æ‡¶®‡ßá ‡¶ú‡ßÄ‡¶¨‡¶æ‡¶£‡ßÅ ‡¶¢‡ßÅ‡¶ï‡ßá ‡¶á‡¶®‡¶´‡ßá‡¶ï‡¶∂‡¶® ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
                            </ul>
                        </div>
                        <div>
                            <h4 class="font-semibold text-lg mb-2 text-rose-700">‡¶¶‡ßÄ‡¶∞‡ßç‡¶ò‡¶Æ‡ßá‡ßü‡¶æ‡¶¶‡ßÄ ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø:</h4>
                            <ul class="list-disc list-inside space-y-2 text-gray-700">
                                <li>‡¶†‡ßã‡¶Å‡¶ü‡ßá ‡¶∏‡ßç‡¶•‡¶æ‡ßü‡ßÄ ‡¶¶‡¶æ‡¶ó ‡¶¨‡¶æ ‡¶ï‡¶æ‡¶≤‡ßã ‡¶õ‡ßã‡¶™ ‡¶™‡ßú‡ßá ‡¶Ø‡ßá‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
                                <li>‡¶†‡ßã‡¶Å‡¶ü‡ßá‡¶∞ ‡¶∏‡ßç‡¶¨‡¶æ‡¶≠‡¶æ‡¶¨‡¶ø‡¶ï ‡¶Ü‡¶ï‡ßÉ‡¶§‡¶ø ‡¶®‡¶∑‡ßç‡¶ü ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
                                <li>‡¶ñ‡ßÅ‡¶¨ ‡¶¨‡¶ø‡¶∞‡¶≤ ‡¶ï‡ßç‡¶∑‡ßá‡¶§‡ßç‡¶∞‡ßá, ‡¶¨‡¶õ‡¶∞‡ßá‡¶∞ ‡¶™‡¶∞ ‡¶¨‡¶õ‡¶∞ ‡¶ß‡¶∞‡ßá ‡¶ö‡¶≤‡¶§‡ßá ‡¶•‡¶æ‡¶ï‡¶æ ‡¶ï‡ßç‡¶∑‡¶§ ‡¶Ø‡¶¶‡¶ø ‡¶®‡¶æ ‡¶∏‡¶æ‡¶∞‡ßá, ‡¶§‡¶¨‡ßá ‡¶§‡¶æ ‡¶•‡ßá‡¶ï‡ßá ‡¶ì‡¶∞‡¶æ‡¶≤ ‡¶ï‡ßç‡¶Ø‡¶æ‡¶®‡ßç‡¶∏‡¶æ‡¶∞‡ßá‡¶∞ ‡¶Æ‡¶§‡ßã ‡¶≠‡ßü‡¶æ‡¶¨‡¶π ‡¶∞‡ßã‡¶ó‡ßá‡¶∞ ‡¶ù‡ßÅ‡¶Å‡¶ï‡¶ø‡¶ì ‡¶§‡ßà‡¶∞‡¶ø ‡¶π‡¶§‡ßá ‡¶™‡¶æ‡¶∞‡ßá‡•§</li>
                            </ul>
                        </div>
                    </div>
                     <p class="text-center mt-6 text-gray-600">‡¶Ü‡¶Æ‡¶ø ‡¶§‡ßã‡¶Æ‡¶æ‡¶ï‡ßá ‡¶≠‡ßü ‡¶¶‡ßá‡¶ñ‡¶æ‡¶§‡ßá ‡¶ö‡¶æ‡¶á ‡¶®‡¶æ, ‡¶¨‡¶â‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶∂‡ßÅ‡¶ß‡ßÅ ‡¶ö‡¶æ‡¶á ‡¶§‡ßÅ‡¶Æ‡¶ø ‡¶∏‡ßÅ‡¶∏‡ßç‡¶• ‡¶•‡¶æ‡¶ï‡ßã, ‡¶∏‡ßÅ‡¶®‡ßç‡¶¶‡¶∞ ‡¶•‡¶æ‡¶ï‡ßã‡•§ ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶ï‡ßã‡¶®‡ßã ‡¶ï‡ßç‡¶∑‡¶§‡¶ø ‡¶π‡ßã‡¶ï, ‡¶§‡¶æ ‡¶Ü‡¶Æ‡¶ø ‡¶ö‡¶æ‡¶á ‡¶®‡¶æ‡•§</p>
                </section>
            </main>

            <footer class="text-center mt-12 text-gray-600">
                <p>‡¶∏‡¶¨‡¶∏‡¶Æ‡ßü ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶™‡¶æ‡¶∂‡ßá ‡¶Ü‡¶õ‡¶ø, ‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ü¶Å</p>
            </footer>
        </div>
    </div>

    <script type="module">
        // Firebase SDKs
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
        import { getAuth, signInAnonymously, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
        import { getFirestore, doc, getDoc, setDoc, collection, onSnapshot, query } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

        // Your web app's Firebase configuration from your Firebase project
        const firebaseConfig = {
            apiKey: "AIzaSyCsIrbUUq5o9gErERw15A0WGEK5bH52o_A",
            authDomain: "ananna1-f1616.firebaseapp.com",
            projectId: "ananna1-f1616",
            storageBucket: "ananna1-f1616.appspot.com",
            messagingSenderId: "196465650362",
            appId: "1:196465650362:web:84a053f7304a303ac47083",
            measurementId: "G-W06HE0WPRP"
        };

        // --- App Specific Constants ---
        const challengeUserId = 'ananna-doraemon-challenge-016';

        // --- Firebase Initialization ---
        const app = initializeApp(firebaseConfig);
        const auth = getAuth(app);
        const db = getFirestore(app);

        // --- DOM Elements ---
        const pinScreen = document.getElementById('pin-screen');
        const mainContent = document.getElementById('main-content');
        const pinInput = document.getElementById('pin-input');
        const enterBtn = document.getElementById('enter-btn');
        const pinError = document.getElementById('pin-error');
        
        const mainHeader = document.getElementById('main-header');
        const loadingState = document.getElementById('loading-state');
        const startState = document.getElementById('start-state');
        const activeChallengeState = document.getElementById('active-challenge-state');
        const startChallengeBtn = document.getElementById('start-challenge-btn');
        const challengeDayText = document.getElementById('challenge-day-text');
        const progressBar = document.getElementById('progress-bar');
        const logForm = document.getElementById('log-form');
        const biteCountInput = document.getElementById('bite-count');
        const logTodayBtn = document.getElementById('log-today-btn');
        const logFeedback = document.getElementById('log-feedback');
        const observerStatus = document.getElementById('observer-status');
        const partnerStatusText = document.getElementById('partner-status-text');
        const historySection = document.getElementById('history-section');
        const logHistory = document.getElementById('log-history');

        let challengeUnsubscribe = null;
        let logsUnsubscribe = null;
        
        const getTodayDateString = () => new Date().toISOString().split('T')[0];
        
        // --- Authentication and App Start ---
        onAuthStateChanged(auth, async (user) => {
            if (!user) {
                try {
                    await signInAnonymously(auth);
                } catch (error) { 
                    console.error("Anonymous Sign-in error:", error);
                    pinError.textContent = "‡¶°‡ßá‡¶ü‡¶æ‡¶¨‡ßá‡¶∏ ‡¶∏‡¶Ç‡¶Ø‡ßã‡¶ó‡ßá ‡¶∏‡¶Æ‡¶∏‡ßç‡¶Ø‡¶æ ‡¶π‡¶ö‡ßç‡¶õ‡ßá‡•§";
                }
            }
        });

        enterBtn.addEventListener('click', () => {
            if (!auth.currentUser) {
                pinError.textContent = "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡ßÅ ‡¶Ö‡¶™‡ßá‡¶ï‡ßç‡¶∑‡¶æ ‡¶ï‡¶∞‡ßÅ‡¶®...";
                return;
            }
            const pin = pinInput.value;
            if (pin === '16' || pin === '1616') {
                pinScreen.classList.add('hidden');
                mainContent.classList.remove('hidden');
                const mode = pin === '16' ? 'user' : 'observer';
                setupApp(mode);
            } else {
                pinError.textContent = '‡¶≠‡ßÅ‡¶≤ ‡¶™‡¶ø‡¶®‡•§ ‡¶Ü‡¶¨‡¶æ‡¶∞ ‡¶ö‡ßá‡¶∑‡ßç‡¶ü‡¶æ ‡¶ï‡¶∞‡ßã‡•§';
                pinInput.value = '';
            }
        });
        pinInput.addEventListener('keyup', (event) => {
            if (event.key === 'Enter') {
                enterBtn.click();
            }
        });

        function setupApp(mode) {
            if (mode === 'user') {
                mainHeader.textContent = '‡¶Ü‡¶Æ‡¶æ‡¶∞ Ananna-‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø';
                logForm.classList.remove('hidden');
                observerStatus.classList.add('hidden');
            } else { // observer mode
                mainHeader.textContent = '‡¶Ü‡¶Æ‡¶æ‡¶∞ Doraemon-‡¶è‡¶∞ ‡¶∞‡¶ø‡¶™‡ßã‡¶∞‡ßç‡¶ü ü¶Å';
                logForm.classList.add('hidden');
                observerStatus.classList.remove('hidden');
                startState.querySelector('p').textContent = "‡¶∏‡ßá ‡¶è‡¶ñ‡¶®‡¶ì ‡¶ö‡ßç‡¶Ø‡¶æ‡¶≤‡ßá‡¶û‡ßç‡¶ú ‡¶∂‡ßÅ‡¶∞‡ßÅ ‡¶ï‡¶∞‡ßá‡¶®‡¶ø‡•§";
                startState.querySelector('button').classList.add('hidden');
            }
            listenForChallengeData();
        }

        // --- Firestore Logic ---
        const getChallengeDocRef = () => doc(db, "challenges", challengeUserId);
        const getLogsCollectionRef = () => collection(db, "challenges", challengeUserId, "logs");
        const getLogDocRef = (dateStr) => doc(db, "challenges", challengeUserId, "logs", dateStr);

        function listenForChallengeData() {
            if (challengeUnsubscribe) challengeUnsubscribe();
            
            const challengeDocRef = getChallengeDocRef();
            challengeUnsubscribe = onSnapshot(challengeDocRef, (docSnap) => {
                loadingState.classList.add('hidden');
                if (docSnap.exists()) {
                    const data = docSnap.data();
                    startState.classList.add('hidden');
                    activeChallengeState.classList.remove('hidden');
                    historySection.classList.remove('hidden');
                    updateChallengeUI(data.startDate.toDate());
                    listenForLogs();
                } else {
                    startState.classList.remove('hidden');
                    activeChallengeState.classList.add('hidden');
                    historySection.classList.add('hidden');
                }
            }, (error) => console.error("Error listening to challenge:", error));
        }

        function listenForLogs() {
            if (logsUnsubscribe) logsUnsubscribe();
            
            const logsQuery = query(getLogsCollectionRef());
            logsUnsubscribe = onSnapshot(logsQuery, (querySnapshot) => {
                const logs = [];
                querySnapshot.forEach((doc) => logs.push({ id: doc.id, ...doc.data() }));
                logs.sort((a, b) => new Date(b.id) - new Date(a.id));
                renderLogs(logs);
            }, (error) => console.error(`Error listening for logs:`, error));
        }

        function updateChallengeUI(startDate) {
            const now = new Date();
            const diffTime = Math.abs(now - startDate);
            const currentDay = Math.floor(diffTime / (1000 * 60 * 60 * 24)) + 1;
            const displayDay = Math.min(currentDay, 30);
            const progressPercentage = (displayDay / 30) * 100;

            challengeDayText.textContent = `‡¶¶‡¶ø‡¶®: ${displayDay}/‡ß©‡ß¶`;
            progressBar.style.width = `${progressPercentage}%`;
            checkIfLoggedToday();
        }

        function renderLogs(logs) {
            logHistory.innerHTML = '';
            if (logs.length === 0) {
                logHistory.innerHTML = '<p class="text-center text-gray-500">‡¶è‡¶ñ‡¶®‡¶ì ‡¶ï‡ßã‡¶®‡ßã ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡¶®‡¶ø‡•§</p>';
                partnerStatusText.textContent = "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡ßü‡¶®‡¶ø‡•§";
                return;
            }

            logs.forEach(log => {
                const logDate = new Date(log.id);
                const formattedDate = logDate.toLocaleDateString('bn-BD', { day: 'numeric', month: 'long', year: 'numeric' });
                const logElement = document.createElement('div');
                logElement.className = 'flex justify-between items-center bg-gray-100 p-3 rounded-lg';
                logElement.innerHTML = `
                    <span class="font-medium">${formattedDate}</span>
                    <span class="font-bold text-teal-600">${log.count} ‡¶¨‡¶æ‡¶∞</span>
                `;
                logHistory.appendChild(logElement);
            });
            
            const todayStr = getTodayDateString();
            const todayLog = logs.find(log => log.id === todayStr);
            if(todayLog) {
                partnerStatusText.textContent = `‡¶Ü‡¶ú ‡¶∏‡ßá ${todayLog.count} ‡¶¨‡¶æ‡¶∞ ‡¶†‡ßã‡¶Å‡¶ü ‡¶ï‡¶æ‡¶Æ‡ßú‡ßá‡¶õ‡ßá‡•§`;
            } else {
                partnerStatusText.textContent = "‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶è‡¶ñ‡¶®‡ßã ‡¶ï‡ßã‡¶®‡ßã ‡¶§‡¶•‡ßç‡¶Ø ‡¶ú‡¶Æ‡¶æ ‡¶¶‡ßá‡ßü‡¶®‡¶ø‡•§";
            }
        }

        async function checkIfLoggedToday() {
            const todayStr = getTodayDateString();
            const logDocRef = getLogDocRef(todayStr);
            const docSnap = await getDoc(logDocRef);
            if (docSnap.exists()) {
                biteCountInput.value = docSnap.data().count;
                logTodayBtn.textContent = "‡¶Ü‡¶™‡¶°‡ßá‡¶ü ‡¶ï‡¶∞‡ßã";
            } else {
                biteCountInput.value = '';
                logTodayBtn.textContent = "‡¶ú‡¶Æ‡¶æ ‡¶¶‡¶æ‡¶ì";
            }
        }

        startChallengeBtn.addEventListener('click', async () => {
            const challengeDocRef = getChallengeDocRef();
            await setDoc(challengeDocRef, { startDate: new Date() });
        });

        logTodayBtn.addEventListener('click', async () => {
            const count = parseInt(biteCountInput.value, 10);
            if (isNaN(count) || count < 0) {
                logFeedback.textContent = "‡¶Ö‡¶®‡ßÅ‡¶ó‡ßç‡¶∞‡¶π ‡¶ï‡¶∞‡ßá ‡¶è‡¶ï‡¶ü‡¶ø ‡¶∏‡¶†‡¶ø‡¶ï ‡¶∏‡¶Ç‡¶ñ‡ßç‡¶Ø‡¶æ ‡¶¶‡¶æ‡¶ì‡•§";
                logFeedback.classList.add('text-red-500');
                return;
            }
            const todayStr = getTodayDateString();
            const logDocRef = getLogDocRef(todayStr);
            await setDoc(logDocRef, { count: count, date: new Date() }, { merge: true });
            logFeedback.textContent = `‡¶§‡ßã‡¶Æ‡¶æ‡¶∞ ‡¶Ü‡¶ú‡¶ï‡ßá‡¶∞ ‡¶∞‡ßá‡¶ï‡¶∞‡ßç‡¶° (${count} ‡¶¨‡¶æ‡¶∞) ‡¶ú‡¶Æ‡¶æ ‡¶π‡ßü‡ßá‡¶õ‡ßá‡•§ ‡¶Ü‡¶Æ‡¶ø ‡¶ñ‡ßÅ‡¶¨ ‡¶ñ‡ßÅ‡¶∂‡¶ø!`;
            logFeedback.classList.remove('text-red-500');
            setTimeout(() => { logFeedback.textContent = ''; }, 3000);
        });
    </script>
</body>
</html>

